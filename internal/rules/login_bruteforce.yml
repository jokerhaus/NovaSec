# internal/rules/login_bruteforce.yml
# Правило для обнаружения брутфорс атак на SSH

id: "login_bruteforce"
name: "SSH Login Bruteforce Detection"
description: "Обнаруживает множественные неудачные попытки входа по SSH с одного IP адреса"
severity: "high"
enabled: true

window:
  duration: "5m"
  sliding: true

group_by: ["src_ip", "host"]

threshold:
  count: 10
  type: "count"
  field: ""

suppress:
  duration: "15m"
  key: "rule_id + src_ip + host"

conditions:
  - field: "category"
    operator: "equals"
    value: "auth"
    invert: false
  
  - field: "subtype"
    operator: "equals"
    value: "login"
    invert: false
  
  - field: "severity"
    operator: "equals"
    value: "high"
    invert: false
  
  - field: "message"
    operator: "contains"
    value: "Failed password"
    invert: false

actions:
  - type: "alert"
    config:
      title: "SSH Bruteforce Attack Detected"
      description: "Multiple failed SSH login attempts detected"
    delay: "0s"
    retry: 3
    timeout: "30s"
  
  - type: "notify"
    config:
      channels: ["email", "telegram"]
      template: "ssh_bruteforce"
    delay: "0s"
    retry: 2
    timeout: "10s"

metadata:
  tags: ["ssh", "bruteforce", "auth"]
  references:
    - "https://attack.mitre.org/techniques/T1110/"
    - "https://attack.mitre.org/techniques/T1110/001/"
  priority: 1
  category: "authentication"
  mitre_technique: "T1110.001"
